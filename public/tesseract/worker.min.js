importScripts('https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/worker.min.js');

const worker = new Worker('tesseract-core.wasm.js', {
  workerType: 'module',
});

self.onmessage = function(e) {
  const { jobId, data, action } = e.data;
  
  switch (action) {
    case 'recognize':
      worker.postMessage({ jobId, action: 'loadLanguage', data: 'eng+spa' });
      worker.postMessage({ jobId, action: 'initialize', data: 'eng+spa' });
      worker.postMessage({ jobId, action: 'recognize', data });
      break;
      
    case 'terminate':
      worker.terminate();
      self.close();
      break;
  }
};

worker.onmessage = function(e) {
  self.postMessage(e.data);
};

worker.onerror = function(e) {
  self.postMessage({
    status: 'error',
    error: e.message
  });
};
